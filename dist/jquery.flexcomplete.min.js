/*! Flexcomplete - v0.1.0 - 2015-12-09
* https://github.com/thiago/flexcomplete
* Copyright (c) 2015 Thiago Andrade; Licensed MIT */
!function(a){"use strict";function b(){return this}var c="Flexcomplete.instance",d="Flexcomplete.data",e=11111,f=13,g=37,h=39,i=38,j=40,k=33,l=34,m=27,n=36,o=35,p=function(b){b=C(b);var e=a(b.target),f=e.data(c);"undefined"!=typeof f&&(f.onSelect(e.data(d),f.input.get(0)),f.isOpened()&&f.close())},q=function(b){var c=a(b.target);c=c.is(".flexcomplete-line")?c:c.find(".flexcomplete-line:first"),c.addClass("active")},r=function(b){var c=a(b.target);c=c.is(".flexcomplete-line")?c:c.find(".flexcomplete-line:first"),c.removeClass("active")},s=function(a,b){B(a,C(b))},t=function(a,b){a.isOpened()&&a._debug!==!0&&a.close(C(b))},u=function(a){var b=a.ascii;return b===i||b===j||b===g||b===h||b===f||b===k||b===l||b===m||b===n||b===o},v=function(b){b.parentEl.html("");for(var e=0;e<b.children.length;e++){var f=b.children[e],g=b.getLine(f),h=a("<li class='flexcomplete-line list-group-item'></li>").append(g);b.children[e]=h.data(d,f).data(c,b).append(h).mousedown(p).mouseover(q).mouseout(r),b.parentEl.append(b.children[e])}return b},w=function(b,c){var e=b.input.offset(),f=b.input.outerHeight();if(b.children=[],b.parentIndex=-1,"undefined"!=typeof b.parentEl&&b.parentEl.remove(),b.parentEl=a('<div class="flexcomplete-parent list-group"></div>').css({display:"none",top:e.top+f+"px",left:e.left+"px",width:b.width+"px"}),a("body").append(b.parentEl),c&&c.length){for(var g=0,h=c.length;h>g;g++)b.children.push(c[g]);b.parentEl.show()}else b.parentEl.hide();v(b).open(),1===b.children.length&&b.selectIfOneResult===!0&&(b.onSelect(b.children[0].data(d),b.input.get(0)),b.isOpened()&&b.close())},x=function(b,c){if("undefined"!=typeof b.interval&&clearInterval(b.interval),b.scheduler.executed!==!0){if(0===a.trim(b.input.val()).length||a.trim(b.input.val()).length<b.startIn)return b.isOpened()&&b.close(),!1;var d={};if(d[b.queryVar]=b.processInput(b.input.val()),"object"==typeof b.extraParams)a.each(b.extraParams,function(b,c){d[b]=a.isFunction(c)?c():c});else{if("function"!=typeof b.extraParams)throw new Error("Extra params should be an object or a function");a.each(b.extraParams(),function(b,c){d[b]=a.isFunction(c)?c():c})}if(b.staticDataSearch===!0){var e=b.filter(b.data,b.input.get(0));b.onFilter(e),w(b,e),b.scheduler.executed=!0}else a.ajax({type:b.method,dataType:"json",url:b.url,async:!0,data:d,success:function(a,c){b.onFilter(a),w(b,a),b.scheduler.executed=!0},error:function(a){throw new Error(a)}})}},y=function(a,b){var c=b.ascii;if(c===m)return void a.close();var e=a.parentIndex;if(a.children.length>=1)if(c===i||c===j||c===k||c===l)c===i?a.parentIndex=a.parentIndex>=1?a.parentIndex-1:a.children.length-1:c===j?a.parentIndex=a.parentIndex<a.children.length-1?a.parentIndex+1:0:c===k?a.parentIndex=a.parentIndex-a.jump>=0?a.parentIndex-a.jump:0:c===l&&(a.parentIndex=a.parentIndex+a.jump<a.children.length?a.parentIndex+a.jump:a.children.length-1),A(a,e,a.parentIndex);else if(c===f)return a.parentIndex>=0&&a.onSelect(a.children[a.parentIndex].data(d),a.input.get(0)),void(a.isOpened()&&a.close());a.autoReplacing===!0&&a.parentIndex>=0&&a.children.length>=1&&a.input.val(a.getInputValue(a.children[a.parentIndex].data(d))),a.open()},z=function(a,b){b=C(b),u(b)!==!1&&y(a,b)},A=function(a,b,c){b>=0&&a.children[b].removeClass("active"),c>=0&&a.children[c].addClass("active")},B=function(b,c){if(c=C(c),u(c)===!1){if(0===a.trim(b.input.val()).length||a.trim(b.input.val()).length<b.startIn)return void(b.isOpened()&&b.close());var d=(new Date).getTime();if(b.scheduler&&b.scheduler.executed===!0&&b.scheduler.timestamp+b.delay<d?(b.scheduler.executed=!1,b.scheduler.timestamp=d):b.scheduler={executed:!1,timestamp:d},"focus"===c.type.toLowerCase())return void x(b,c);b.interval&&clearInterval(b.interval),b.interval=setInterval(function(){x(b,c)},b.delay)}},C=function(b){return b.ascii?b:(b=a.event.fix(b||window.event),{type:b.type,ascii:b.keyCode?b.keyCode:b.which,target:a(b.target).get(0)})};a.extend(b.prototype,{extend:function(){a.extend.apply(this,[].prototype.slice.call(arguments))},load:function(b){var d=this;b=a.extend({},a.flexcomplete.options,b);for(var e in b)this[e]=b[e]||null;if(this._debug=!1,this.staticDataSearch="undefined"!=typeof this.data,!(this.staticDataSearch||this.url&&""!==a.trim(this.url)))throw new Error("No database set. Please, set the offline data or an url");return this.width="undefined"!=typeof this.width&&null!==this.width?this.width:this.input.outerWidth(),this.children=[],this.parentIndex=-1,"undefined"==typeof this.input.data(c)&&this.input.data(c,this),this.input.attr("autocomplete","off"),this.input.bind("keyup.Flexcomplete",function(a){B(d,a)}).bind("keydown.Flexcomplete",function(a){z(d,a)}).bind("focus.Flexcomplete",function(a){s(d,a)}).bind("blur.Flexcomplete",function(a){t(d,a)}),this},select:function(a){this.onSelect(a,this.input.get(0))},close:function(a){"undefined"!=typeof this.parentEl&&this.parentEl.hide(),this.opened=!1},open:function(){this.opened=!0,"undefined"!=typeof this.parentEl&&this.parentEl.show()},isOpened:function(){return this.opened},search:function(){return B(this,{type:"keyup",target:this.input,ascii:e})},staticData:function(a){return"undefined"!=typeof a&&(this.data=a),this.data},sdata:function(a){return this.staticData(a)},debug:function(a){this._debug=a},unload:function(){this.close(),this.input.unbind("keyup.Flexcomplete",B),this.input.unbind("keydown.Flexcomplete",z),this.input.unbind("focus.Flexcomplete",s),this.input.unbind("blur.Flexcomplete",t),"undefined"!=typeof this.parentEl&&(this.parentEl.empty(),this.parentEl.remove()),this.input.removeData(c)}}),a.fn.flexcomplete=function(d){var e,f,g=a(this).data(c),h=Array.prototype.slice.call(arguments,1);return"string"!=typeof d?this.each(function(g,h){return"undefined"==typeof a(this).data(c)&&"object"==typeof d&&(f=new b,e={},a.each(d,function(a,b){e[a]=b}),e.input=a(this),f.load(e),a(this).data(c,f)),this}):/open|close|search|select|unload|staticData|extend|sdata|debug/.test(d)?g[d].apply(g,h):void(console&&console.warn("No such "+d+" command found"))},a.fn.unflexcomplete=function(){return this.each(function(){var b=a(this).data(c);return"object"==typeof b&&b.unload(),this})},a.flexcomplete=function(b){return b=a.extend({},a.flexcomplete.options,b),"awesome"+b.punctuation},a.flexcomplete.options={queryVar:"q",method:"GET",processInput:function(a){return a},onSelect:function(a,b){b.value=a},getLine:function(a){return a},onFilter:function(){},getFullText:function(a){return a},getInputValue:function(a){return a},matches:function(b,c,d){return"undefined"==typeof d&&(d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i")),d.test(b)},filter:function(b,c){c="INPUT"===c.tagName?a(c).val():c;var d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i");return b.filter(function(a){return this.matches(a,c,d)},this)},delay:100,jump:6,startIn:1,width:null,selectIfOneResult:!1,staticDataSearch:!1,extraParams:{},autoReplacing:!1},a.expr[":"].flexcomplete=function(b){return-1!==a(b).text().indexOf("awesome")}}(jQuery);