/*! Flexcomplete - v0.1.0 - 2015-12-08
* https://github.com/thiago/flexcomplete
* Copyright (c) 2015 Thiago Andrade; Licensed MIT */
!function(a){"use strict";function b(){return this}var c="Flexcomplete.instance",d="Flexcomplete.data",e=11111,f=13,g=37,h=39,i=38,j=40,k=33,l=34,m=27,n=36,o=35,p=function(a,b){x(a,y(b))},q=function(a,b){a.isOpened()&&a.close(y(b))},r=function(a){var b=a.ascii;return b===i||b===j||b===g||b===h||b===f||b===k||b===l||b===m||b===n||b===o},s=function(b){b.parentEl.html("");for(var e=0;e<b.children.length;e++){var f=b.children[e],g=b.getLine(f),h=a("<div class='flexcomplete-line'></div>").append(g);b.children[e]=a("<div align='left' class='flexcomplete-line-common'></div>").data(d,f).data(c,b).append(h).mousedown(b.choosingClick).mouseover(b.mouseOver).mouseout(b.mouseOut),b.parentEl.append(b.children[e])}return b},t=function(b,c){var e=b.input.offset(),f=b.input.outerHeight();if(b.children=[],b.parentIndex=-1,"undefined"!=typeof b.parentEl&&b.parentEl.remove(),b.parentEl=a('<div class="flexcomplete-parentEl"></div>').css({display:"none",top:e.top+f+"px",left:e.left+"px",width:b.width+"px"}),a("body").append(b.parentEl),c&&c.length){for(var g=0,h=c.length;h>g;g++)b.children.push(c[g]);b.parentEl.show()}else b.parentEl.hide();s(b).open(),1===b.children.length&&b.selectIfOneResult===!0&&(b.onSelect(b.children[0].data(d),b.input.get(0)),b.isOpened()&&b.close())},u=function(b,c){if("undefined"!=typeof b.interval&&clearInterval(b.interval),b.scheduler.executed!==!0){if(0===a.trim(b.input.val()).length||a.trim(b.input.val()).length<b.startIn)return b.isOpened()&&b.close(),!1;var d={};if(d[b.queryVar]=b.processInput(b.input.val()),"object"==typeof b.extraParams)a.each(b.extraParams,function(b,c){d[b]=a.isFunction(c)?c():c});else{if("function"!=typeof b.extraParams)throw new Error("Extra params should be an object or a function");a.each(b.extraParams(),function(b,c){d[b]=a.isFunction(c)?c():c})}if(b.staticDataSearch===!0){var e=b.filter(b.data,b.input.get(0));b.onFilter(e),t(b,e),b.scheduler.executed=!0}else a.ajax({type:b.method,dataType:"json",url:b.url,async:!0,data:d,success:function(a,c){b.onFilter(a),t(b,a),b.scheduler.executed=!0},error:function(a){throw new Error(a)}})}},v=function(a,b){var c=b.ascii;if(c===m)return void a.close();var e=a.parentIndex;if(a.children.length>=1)if(c===i||c===j||c===k||c===l)c===i?a.parentIndex=a.parentIndex>=1?a.parentIndex-1:a.children.length-1:c===j?a.parentIndex=a.parentIndex<a.children.length-1?a.parentIndex+1:0:c===k?a.parentIndex=a.parentIndex-a.jump>=0?a.parentIndex-a.jump:0:c===l&&(a.parentIndex=a.parentIndex+a.jump<a.children.length?a.parentIndex+a.jump:a.children.length-1),a.hover(e,a.parentIndex);else if(c===f)return a.parentIndex>=0&&a.onSelect(a.children[a.parentIndex].data(d),a.input.get(0)),void(a.isOpened()&&a.close());a.autoReplacing===!0&&a.parentIndex>=0&&a.children.length>=1&&a.input.val(a.getInputValue(a.children[a.parentIndex].data(d))),a.open()},w=function(a,b){b=y(b),r(b)!==!1&&v(a,b)},x=function(b,c){if(c=y(c),r(c)===!1){if(0===a.trim(b.input.val()).length||a.trim(b.input.val()).length<b.startIn)return void(b.isOpened()&&b.close());var d=(new Date).getTime();if(b.scheduler&&b.scheduler.executed===!0&&b.scheduler.timestamp+b.delay<d?(b.scheduler.executed=!1,b.scheduler.timestamp=d):b.scheduler={executed:!1,timestamp:d},"focus"===c.type.toLowerCase())return void u(b,c);b.interval&&clearInterval(b.interval),b.interval=setInterval(function(){u(b,c)},b.delay)}},y=function(b){return b.ascii?b:(b=a.event.fix(b||window.event),{type:b.type,ascii:b.keyCode?b.keyCode:b.which,target:a(b.target).get(0)})};a.extend(b.prototype,{extend:function(){a.extend.apply(this,[].prototype.slice.call(arguments))},load:function(b){var d=this;b=a.extend({},a.flexcomplete.options,b);for(var e in b)this[e]=b[e]||null;if(this.staticDataSearch="undefined"!=typeof this.data,!(this.staticDataSearch||this.url&&""!==a.trim(this.url)))throw new Error("No database set. Please, set the offline data or an url");return this.width="undefined"!=typeof this.width&&null!==this.width?this.width:this.input.outerWidth(),this.children=[],this.parentIndex=-1,"undefined"==typeof this.input.data(c)&&this.input.data(c,this),this.input.bind("keyup.Flexcomplete",function(a){x(d,a)}).bind("keydown.Flexcomplete",function(a){w(d,a)}).bind("focus.Flexcomplete",function(a){p(d,a)}).bind("blur.Flexcomplete",function(a){q(d,a)}),this},hover:function(a,b){var c=this;a>=0&&c.children[a].find(".flexcomplete-line:first").removeClass("flexcomplete-line-hover"),b>=0&&c.children[b].find(".flexcomplete-line:first").addClass("flexcomplete-line-hover")},select:function(a){this.onSelect(a,this.input.get(0))},close:function(a){"undefined"!=typeof this.parentEl&&this.parentEl.hide(),this.opened=!1},open:function(){this.opened=!0,"undefined"!=typeof this.parentEl&&this.parentEl.show()},isOpened:function(){return this.opened},search:function(){return x(this,{type:"keyup",target:this.input,ascii:e})},staticData:function(a){return"undefined"!=typeof a&&(this.data=a),this.data},sdata:function(a){return this.staticData(a)},unload:function(){this.close(),this.input.unbind("keyup.Flexcomplete",x),this.input.unbind("keydown.Flexcomplete",w),this.input.unbind("focus.Flexcomplete",p),this.input.unbind("blur.Flexcomplete",q),"undefined"!=typeof this.parentEl&&(this.parentEl.empty(),this.parentEl.remove()),this.input.removeData(c)}}),a.fn.flexcomplete=function(d){var e,f,g=a(this).data(c),h=Array.prototype.slice.call(arguments,1);return"string"!=typeof d?this.each(function(g,h){return"undefined"==typeof a(this).data(c)&&"object"==typeof d&&(f=new b,e={},a.each(d,function(a,b){e[a]=b}),e.input=a(this),f.load(e),a(this).data(c,f)),this}):/open|close|search|select|unload|staticData|extend|sdata/.test(d)?g[d].apply(g,h):void(console&&console.warn("No such "+d+" command found"))},a.fn.unflexcomplete=function(){return this.each(function(){var b=a(this).data(c);return"object"==typeof b&&b.unload(),this})},a.flexcomplete=function(b){return b=a.extend({},a.flexcomplete.options,b),"awesome"+b.punctuation},a.flexcomplete.options={queryVar:"q",method:"GET",processInput:function(a){return a},onSelect:function(a,b){b.value=a},getLine:function(a){return a},onFilter:function(){},getFullText:function(a){return a},getInputValue:function(a){return a},matches:function(b,c,d){return"undefined"==typeof d&&(d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i")),d.test(b)},filter:function(b,c){c="INPUT"===c.tagName?a(c).val():c;var d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i");return b.filter(function(a){return this.matches(a,c,d)},this)},delay:100,jump:6,startIn:3,width:null,selectIfOneResult:!1,staticDataSearch:!1,extraParams:{},autoReplacing:!1},a.expr[":"].flexcomplete=function(b){return-1!==a(b).text().indexOf("awesome")}}(jQuery);