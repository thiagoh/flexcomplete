/*! Flexcomplete - v0.1.0 - 2015-12-23
* https://github.com/thiago/flexcomplete
* Copyright (c) 2015 Thiago Andrade; Licensed MIT */
!function(a){"use strict";function b(){return this}var c="Flexcomplete.instance",d="Flexcomplete.data",e=11111,f=13,g=37,h=39,i=38,j=40,k=33,l=34,m=27,n=36,o=35,p=function(b){var e=a(C(b).target),f=e.closest(".flexcomplete-parent").data(c);"undefined"!=typeof f&&(f.onSelect(e.data(d),f.$input.get(0)),f.isOpened()&&f.close())},q=function(b){var c=a(b.target);(c.is(".flexcomplete-line")?c:c.find(".flexcomplete-line:first")).addClass("active")},r=function(b){var c=a(b.target);(c.is(".flexcomplete-line")?c:c.find(".flexcomplete-line:first")).removeClass("active")},s=function(a,b){B(a,C(b))},t=function(a,b){a.isOpened()&&a._debug!==!0&&a.close(C(b))},u=function(a){var b=a.ascii;return b===i||b===j||b===g||b===h||b===f||b===k||b===l||b===m||b===n||b===o},v=function(b,c){var e=0,f=c.length;for(b.parentEl.empty();f>e;e++){var g=c[e],h=b.getLine(g),i=a("<li class='flexcomplete-line list-group-item'></li>").append(h);b.children[e]=i.data(d,g).append(i).mousedown(p).mouseover(q).mouseout(r),b.parentEl.append(b.children[e])}return b},w=function(b,e){var f=b.$input.offset(),g=b.$input.outerHeight();if(b.children=[],b.parentIndex=-1,"undefined"!=typeof b.parentEl&&b.parentEl.remove(),b.parentEl=a('<ul class="flexcomplete-parent list-group"></ul>').css({display:"none",top:f.top+g+"px",left:f.left+"px",width:b.width+"px"}).data(c,b),a("body").append(b.parentEl),e&&e.length){for(var h=0,i=e.length;i>h;h++)b.children.push(e[h]);b.parentEl.show(),v(b,e).open()}else b.parentEl.hide();1===b.children.length&&b.selectIfOneResult===!0&&(b.onSelect(b.children[0].data(d),b.$input.get(0)),b.isOpened()&&b.close())},x=function(b,c){if("undefined"!=typeof b.interval&&clearInterval(b.interval),"string"==typeof c&&(b.scheduler||{}).executed!==!0){if(c.length<b.startIn)return void(b.isOpened()&&b.close());var d=a.Deferred(),e={},f={};if(e[b.queryVar]=b.processInput(c),"object"==typeof b.params)a.each(b.params,function(b,c){e[b]=a.isFunction(c)?c():c});else if("function"==typeof b.params)a.each(b.params(b),function(b,c){e[b]=a.isFunction(c)?c():c});else if("undefined"!=typeof b.params)return d.reject("Extra params should be an object, function or undefined"),d.promise();if("object"==typeof b.headers)a.each(b.headers,function(b,c){f[b]=a.isFunction(c)?c():c});else if("function"==typeof b.headers)a.each(b.headers(b),function(b,c){f[b]=a.isFunction(c)?c():c});else if("undefined"!=typeof b.headers)return d.reject("Headers should be an object, function or undefined"),d.promise();return b.staticDataSearch===!0?d.resolve(b.filter(b.data,c)):a.ajax({type:b.httpMethod||b.method,dataType:b.dataType,url:b.url,async:!0,data:e,headers:f,success:function(a,b){d.resolve(a)},error:function(a,b,c){d.reject(b+": "+c)}}),d.then(function(a){"object"==typeof b.scheduler&&(b.scheduler.executed=!0),w(b,a)},function(a){"undefined"!=typeof console&&console.error(a)}),d.promise()}},y=function(a,b){var c=b.ascii;if(c===m)return void a.close();var e=a.parentIndex;if(a.children.length>=1)if(c===i||c===j||c===k||c===l)c===i?a.parentIndex=a.parentIndex>=1?a.parentIndex-1:a.children.length-1:c===j?a.parentIndex=a.parentIndex<a.children.length-1?a.parentIndex+1:0:c===k?a.parentIndex=a.parentIndex-a.jump>=0?a.parentIndex-a.jump:0:c===l&&(a.parentIndex=a.parentIndex+a.jump<a.children.length?a.parentIndex+a.jump:a.children.length-1),A(a,e,a.parentIndex);else if(c===f)return a.parentIndex>=0&&a.onSelect(a.children[a.parentIndex].data(d),a.$input.get(0)),void(a.isOpened()&&a.close());a.autoReplacing===!0&&a.parentIndex>=0&&a.children.length>=1&&a.$input.val(a.getAutoreplacingInputValue(a.children[a.parentIndex].data(d))),a.open()},z=function(a,b){b=C(b),u(b)!==!1&&y(a,b)},A=function(a,b,c){b>=0&&a.children[b].removeClass("active"),c>=0&&a.children[c].addClass("active")},B=function(a,b){if("undefined"==typeof b)return!1;if(b=C(b),u(b)!==!1)return!1;var c=a.$input.val(),d=(new Date).getTime();return a.scheduler&&a.scheduler.executed===!0&&a.scheduler.timestamp+a.delay<d?(a.scheduler.executed=!1,a.scheduler.timestamp=d):a.scheduler={executed:!1,timestamp:d},"focus"===b.type.toLowerCase()?x(a,c):(a.interval&&clearInterval(a.interval),a.interval=setInterval(function(){x(a,c)},a.delay),!0)},C=function(b){return b.ascii?b:(b=a.event.fix(b||window.event),{type:b.type,ascii:b.keyCode?b.keyCode:b.which,target:a(b.target).get(0)})};a.extend(b.prototype,{extend:function(){a.extend.apply(this,[].prototype.slice.call(arguments))},load:function(b){var c=this;b=a.extend({},a.flexcomplete.options,b);for(var d in b)this[d]=b[d]||null;if(this._debug=!1,this.staticDataSearch="undefined"!=typeof this.data,!(this.staticDataSearch||this.url&&""!==a.trim(this.url)))throw new Error("No database set. Please, set the offline data or an url");return this.width="undefined"!=typeof this.width&&null!==this.width?this.width:this.$input.outerWidth(),this.children=[],this.parentIndex=-1,this.params=this.params||this.extraParams,this.$input.attr("autocomplete","off"),this.$input.bind("keyup.Flexcomplete",function(a){B(c,a)}).bind("keydown.Flexcomplete",function(a){z(c,a)}).bind("focus.Flexcomplete",function(a){s(c,a)}).bind("blur.Flexcomplete",function(a){t(c,a)}),this},select:function(a){if("undefined"!=typeof a){var b=(this.children||[])[a];"undefined"!=typeof b&&this.onSelect(b,this.$input.get(0))}},close:function(a){"undefined"!=typeof this.parentEl&&this.parentEl.hide(),this.opened=!1},open:function(){this.opened=!0,"undefined"!=typeof this.parentEl&&this.parentEl.show()},isOpened:function(){return this.opened},search:function(b){return"string"==typeof b&&""!==a.trim(b)?x(this,b):B(this,{type:"keyup",target:this.$input,ascii:e})},staticData:function(a){return"undefined"!=typeof a&&(this.data=a),this.data},sdata:function(a){return this.staticData(a)},debug:function(a){this._debug=a},unload:function(){this.close(),this.$input.unbind("keyup.Flexcomplete",B),this.$input.unbind("keydown.Flexcomplete",z),this.$input.unbind("focus.Flexcomplete",s),this.$input.unbind("blur.Flexcomplete",t),"undefined"!=typeof this.parentEl&&(this.parentEl.empty(),this.parentEl.remove()),this.$input.removeData(c)}}),a.fn.flexcomplete=function(d){var e,f,g=a(this).data(c),h=Array.prototype.slice.call(arguments,1);return"string"!=typeof d?this.each(function(g,h){return"undefined"==typeof a(this).data(c)&&"object"==typeof d&&(f=new b,e={},a.each(d,function(a,b){e[a]=b}),e.$input=a(this),f.load(e),a(this).data(c,f)),this}):/open|close|search|select|unload|staticData|extend|sdata|debug/.test(d)?g[d].apply(g,h):void(console&&console.warn("No such "+d+" command found"))},a.fn.unflexcomplete=function(){return this.each(function(){var b=a(this).data(c);return"object"==typeof b&&b.unload(),this})},a.flexcomplete=function(b){return b=a.extend({},a.flexcomplete.options,b),"awesome"+b.punctuation},a.flexcomplete.options={queryVar:"q",dataType:"json",httpMethod:"GET",processInput:function(a){return a},onSelect:function(a,b){b.value=a},getLine:function(a){return a},getAutoreplacingInputValue:function(a){return a},matches:function(b,c,d){return"undefined"==typeof d&&(d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i")),d.test(b)},filter:function(b,c){c="INPUT"===c.tagName?a(c).val():c;var d=new RegExp(c.replace(a.fn.flexcomplete.reReplace,""),"i");return b.filter(function(a){return this.matches(a,c,d)},this)},delay:100,jump:6,startIn:1,width:null,selectIfOneResult:!1,params:{},headers:{},autoReplacing:!1},a.expr[":"].flexcomplete=function(b){return-1!==a(b).text().indexOf("awesome")}}(jQuery);